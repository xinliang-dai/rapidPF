<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Tillmann MÃ¼hlpfordt">
        <link rel="canonical" href="https://kit-iai.github.io/rapidPF/example/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Example - rapidPF documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">rapidPF documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">RapidPF</a>
                            </li>
                            <li class="navitem">
                                <a href="../installation/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../getting-started/" class="nav-link">Getting started</a>
                            </li>
                            <li class="navitem">
                                <a href="../overview/" class="nav-link">Overview</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Example</a>
                            </li>
                            <li class="navitem">
                                <a href="../assumptions/" class="nav-link">Assumptions</a>
                            </li>
                            <li class="navitem">
                                <a href="../problem-formulation/" class="nav-link">Problem formulation</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Mfiles <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">01 generator</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../mfiles/01_generator/create_skeleton_mpc/" class="dropdown-item">create_skeleton_mpc</a>
</li>
            
<li>
    <a href="../mfiles/01_generator/merge_systems/" class="dropdown-item">merge_systems</a>
</li>
            
<li>
    <a href="../mfiles/01_generator/run_case_file_generator/" class="dropdown-item">run_case_file_generator</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">02 splitter</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../mfiles/02_splitter/add_consensus_information/" class="dropdown-item">add_consensus_information</a>
</li>
            
<li>
    <a href="../mfiles/02_splitter/run_case_file_splitter/" class="dropdown-item">run_case_file_splitter</a>
</li>
            
<li>
    <a href="../mfiles/02_splitter/split_case_file/" class="dropdown-item">split_case_file</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">03 parser</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../mfiles/03_parser/build_consensus_constraints/" class="dropdown-item">build_consensus_constraints</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/create_bus_specifications/" class="dropdown-item">create_bus_specifications</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/create_power_flow_equation_for_p/" class="dropdown-item">create_power_flow_equation_for_p</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/create_power_flow_equation_for_q/" class="dropdown-item">create_power_flow_equation_for_q</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/generate_distributed_problem/" class="dropdown-item">generate_distributed_problem</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/solve_distributed_problem_centralized/" class="dropdown-item">solve_distributed_problem_centralized</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/solve_distributed_problem_with_aladin/" class="dropdown-item">solve_distributed_problem_with_aladin</a>
</li>
            
<li>
    <a href="../mfiles/03_parser/validate_distributed_problem_formulation/" class="dropdown-item">validate_distributed_problem_formulation</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../sensitivities/" class="nav-link">Sensitivities</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../overview/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../assumptions/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/KIT-IAI/rapidPF/edit/master/docs/example.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#example" class="nav-link">Example</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#setup" class="nav-link">Setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#specify-inputs" class="nav-link">Specify inputs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#problem-formulation" class="nav-link">Problem formulation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#problem-solution" class="nav-link">Problem solution</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#comparison" class="nav-link">Comparison</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#post-processing" class="nav-link">Post-processing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#entire-code" class="nav-link">Entire code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="example">Example</h1>
<p>This is a beginning-to-end-example about how to solve distributed power flow with <a href="https://github.com/alexe15/ALADIN.m">the Aladin toolbox</a>.
<a href="#entire-code">Click here</a> to see the plain code.</p>
<h2 id="setup">Setup</h2>
<p>Starting from the home directory of the package, let&rsquo;s make a tabula rasa and switch to the use case folder</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">clear</span> <span class="n">all</span><span class="p">;</span> <span class="n">close</span> <span class="n">all</span><span class="p">;</span> <span class="n">clc</span><span class="p">;</span>
<span class="n">cd</span><span class="p">(</span><span class="s">&#39;00_use-case&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<p>If not done already, add the source files to the path</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="s">&#39;../01_generator/&#39;</span><span class="p">));</span>
<span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="s">&#39;../02_splitter/&#39;</span><span class="p">));</span>
<span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="s">&#39;../03_parser/&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table>
<p>We would like the following fields to be merged from the case files</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">fields_to_merge</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;bus&#39;</span><span class="p">,</span> <span class="s">&#39;gen&#39;</span><span class="p">,</span> <span class="s">&#39;branch&#39;</span><span class="p">};</span>
</pre></div>
</td></tr></table>
<h2 id="specify-inputs">Specify inputs</h2>
<p>We first generate a name struct that acts as a de-facto global variable for naming structs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">names</span> <span class="p">=</span> <span class="n">generate_name_struct</span><span class="p">();</span>
</pre></div>
</td></tr></table>
<p>Next, we specify the master and worker systems by loading their case files.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mpc_master</span>  <span class="p">=</span> <span class="n">loadcase</span><span class="p">(</span><span class="s">&#39;case14&#39;</span><span class="p">);</span>
<span class="n">mpc_workers</span> <span class="p">=</span> <span class="p">{</span> <span class="n">loadcase</span><span class="p">(</span><span class="s">&#39;case30&#39;</span><span class="p">);</span> <span class="n">loadcase</span><span class="p">(</span><span class="s">&#39;case9&#39;</span><span class="p">)</span>  <span class="p">};</span>
</pre></div>
</td></tr></table>
<p>Additionally, we need to specify <em>who</em> is connected to <em>whom</em>.
These connections are specified in a connection array:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">connection_array</span> <span class="p">=</span> <span class="p">[</span> <span class="mi">2</span> <span class="mi">1</span>  <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span>
                     <span class="mi">2</span> <span class="mi">3</span>  <span class="mi">2</span> <span class="mi">3</span><span class="p">;</span> 
                     <span class="mi">2</span> <span class="mi">3</span> <span class="mi">13</span> <span class="mi">1</span><span class="p">;</span> <span class="p">];</span>
</pre></div>
</td></tr></table>
<p>The first row reads: system 2 is connected to system 1, specifically the first bus of system 2 is connected to the second bus of system 1.
Likewise, the second row reads: system 2 is connected to system 3, specifically the second bus of system 2 is connected to the third bus of system 3.</p>
<p>However, we need not just to specify <em>who</em> is connected to <em>whom</em>, but also <em>how</em>.
Hence, we model a connecting transformer.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">trafo_params</span><span class="p">.</span><span class="n">r</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="mf">0.00623</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="n">b</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="n">ratio</span> <span class="p">=</span> <span class="mf">0.985</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="nb">angle</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</td></tr></table>
<p>Finally, we can call <a href="mfiles/01_generator/build_connection_table.md"><code>build_connection_table</code></a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">conn</span> <span class="p">=</span> <span class="n">build_connection_table</span><span class="p">(</span><span class="n">connection_array</span><span class="p">,</span> <span class="n">trafo_params</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h2 id="problem-formulation">Problem formulation</h2>
<p>Having done the setup, we are now ready to use the three main blocks: the case file generator, the case file splitter, and the case file parser:</p>
<h3 id="case-file-generator">Case file generator</h3>
<p>Calling the case file generator means to specify the master and the workers together with the connection table, and what fields shall be merged.
The most convenient way is to call <a href="../mfiles/01_generator/run_case_file_generator/"><code>run_case_file_generator</code></a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mpc_merge</span> <span class="p">=</span> <span class="n">run_case_file_generator</span><span class="p">(</span><span class="n">mpc_master</span><span class="p">,</span> <span class="n">mpc_workers</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">fields_to_merge</span><span class="p">,</span> <span class="n">names</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The output is a case file that has a lot of extra information.</p>
<h3 id="case-file-splitter">Case file splitter</h3>
<p>The output of the case file generator is the input to the case file splitter, together with connection information.
We call <a href="../mfiles/02_splitter/run_case_file_splitter/"><code>run_case_file_splitter</code></a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mpc_split</span> <span class="p">=</span> <span class="n">run_case_file_splitter</span><span class="p">(</span><span class="n">mpc_merge</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">names</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The output is, again, a case file that has a lot of extra information.</p>
<h3 id="case-file-parser">Case file parser</h3>
<p>Finally, the case file parser takes the output from the splitter, and generates a problem formulation, using <a href="mfiles/03_parser/generate_distributed_problem_for_aladin.md"><code>generate_distributed_problem_for_aladin</code></a>.
Note that we can need to specify whether we create a <code>feasibility</code> or a <code>least-squares</code> problem formulation.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">problem</span> <span class="p">=</span> <span class="n">generate_distributed_problem_for_aladin</span><span class="p">(</span><span class="n">mpc_split</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="s">&#39;least-squares&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The problem formulation is a struct that contains all relevant equations.</p>
<p>Finally, we need to add a numerical solver (<code>fmincon</code>, <code>fminunc</code>, <code>worhp</code>, <code>Casadi+Ipopt</code>)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c">% add a solver</span>
<span class="n">problem</span><span class="p">.</span><span class="n">solver</span> <span class="p">=</span> <span class="s">&#39;fmincon&#39;</span><span class="p">;</span>
</pre></div>
</td></tr></table>
<h2 id="problem-solution">Problem solution</h2>
<p>Having created a valid problem formulation, we rely on the <a href="https://github.com/alexe15/ALADIN.m">Aladin toolbox</a> to solve the problem.
Aladin requires a set of parameters (using the default values is also possible, and usually a good idea).
We use the function <a href="../mfiles/03_parser/solve_distributed_problem_with_aladin/"><code>solve_distributed_problem_with_aladin</code></a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">opts</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;maxiter&#39;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span> <span class="s">&#39;solveQP&#39;</span><span class="p">,</span><span class="s">&#39;MA57&#39;</span><span class="p">);</span>
<span class="n">opts</span><span class="p">.</span><span class="n">reg</span> <span class="p">=</span><span class="s">&#39;false&#39;</span><span class="p">;</span>
<span class="n">opts</span><span class="p">.</span><span class="n">rho0</span><span class="p">=</span> <span class="mf">1e2</span><span class="p">;</span>

<span class="p">[</span><span class="n">xsol_aladin</span><span class="p">,</span> <span class="n">xsol_stack_aladin</span><span class="p">,</span> <span class="n">mpc_sol_aladin</span><span class="p">,</span> <span class="n">logg</span><span class="p">]</span> <span class="p">=</span> <span class="n">solve_distributed_problem_with_aladin</span><span class="p">(</span><span class="n">mpc_split</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The function returns four outputs: <code>xsol_aladin</code> and <code>xsol_stack_aladin</code> are both cells with as many entries as there are regions.
In each entry, the state of region <span class="arithmatex"><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> is stored: in <code>xsol_aladin</code> it is a matrix form with as many rows as there are buses in the region, and the four columns being the voltage angle, the voltage magnitude, the net active power, and the net reactive power; in <code>xsol_stack_aladin</code>, each entry is the vertically stacked equivalent of <code>xsol_aladin</code>.
The third output, <code>mpc_sol_aladin</code>, is a valid case file that can be used for further inspection.
The fourth output contains logging information from the Aladin toolbox.</p>
<h2 id="comparison">Comparison</h2>
<p>How do we know that the solution we computed is actually correct?
For that purpose, there is a validation function such as <a href="../mfiles/03_parser/validate_distributed_problem_formulation/"><code>validate_distributed_problem_formulation</code></a>.
Simply put, the function uses <code>matpower</code> to validate that the generated problem formulation stored in <code>problem</code> is correct.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">xval</span><span class="p">,</span> <span class="n">xval_stacked</span><span class="p">]</span> <span class="p">=</span> <span class="n">validate_distributed_problem_formulation</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">mpc_split</span><span class="p">,</span> <span class="n">names</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The outputs have the same format as the first two outputs (<code>xsol_aladin</code> &amp; <code>xsol_stack_aladin</code>) from the <a href="#problem-solution">problem solution</a>.
To compare the results we call <a href="mfiles/03_parser/compare_results.md"><code>compare_results</code></a>, which generates a humand-readable <code>table</code> output.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">comparison_aladin</span> <span class="p">=</span> <span class="n">compare_results</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span> <span class="n">xsol_aladin</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<h2 id="post-processing">Post-processing</h2>
<p>There is a handy function for post-processing,
This function provides a graphical impression of the overall constraint violations for both the power flow equations and the consensus violations.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">compare_constraints_violation</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">logg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>For this example the violation of the power flow equations, the bus specifications, and the consensus constraints are shown below per Aladin iteration.</p>
<p><img alt="Simulation results for example" src="../figs/example-results.png" /></p>
<h2 id="entire-code">Entire code</h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">clear</span> <span class="n">all</span><span class="p">;</span> <span class="n">close</span> <span class="n">all</span><span class="p">;</span> <span class="n">clc</span><span class="p">;</span>

<span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="s">&#39;../01_generator/&#39;</span><span class="p">));</span>
<span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="s">&#39;../02_splitter/&#39;</span><span class="p">));</span>
<span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="s">&#39;../03_parser/&#39;</span><span class="p">));</span>

<span class="n">names</span> <span class="p">=</span> <span class="n">generate_name_struct</span><span class="p">();</span>
<span class="c">%% setup</span>
<span class="n">fields_to_merge</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;bus&#39;</span><span class="p">,</span> <span class="s">&#39;gen&#39;</span><span class="p">,</span> <span class="s">&#39;branch&#39;</span><span class="p">};</span>
<span class="n">mpc_master</span>  <span class="p">=</span> <span class="n">loadcase</span><span class="p">(</span><span class="s">&#39;case14&#39;</span><span class="p">);</span>
<span class="n">mpc_workers</span> <span class="p">=</span> <span class="p">{</span> <span class="n">loadcase</span><span class="p">(</span><span class="s">&#39;case30&#39;</span><span class="p">)</span>
             <span class="n">loadcase</span><span class="p">(</span><span class="s">&#39;case9&#39;</span><span class="p">)</span>  <span class="p">};</span>

<span class="n">connection_array</span> <span class="p">=</span> <span class="p">[</span><span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="mi">2</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">;</span> 
                    <span class="mi">2</span> <span class="mi">3</span> <span class="mi">13</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">];</span>

<span class="n">trafo_params</span><span class="p">.</span><span class="n">r</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="mf">0.00623</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="n">b</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="n">ratio</span> <span class="p">=</span> <span class="mf">0.985</span><span class="p">;</span>
<span class="n">trafo_params</span><span class="p">.</span><span class="nb">angle</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">conn</span> <span class="p">=</span> <span class="n">build_connection_table</span><span class="p">(</span><span class="n">connection_array</span><span class="p">,</span> <span class="n">trafo_params</span><span class="p">);</span>

<span class="c">%% main</span>
<span class="c">% case-file-generator</span>
<span class="n">mpc_merge</span> <span class="p">=</span> <span class="n">run_case_file_generator</span><span class="p">(</span><span class="n">mpc_master</span><span class="p">,</span> <span class="n">mpc_workers</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">fields_to_merge</span><span class="p">,</span> <span class="n">names</span><span class="p">);</span>
<span class="c">% case-file-splitter</span>
<span class="n">mpc_split</span> <span class="p">=</span> <span class="n">run_case_file_splitter</span><span class="p">(</span><span class="n">mpc_merge</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">names</span><span class="p">);</span>
<span class="c">% generate problem formulation for aladin</span>
<span class="n">problem</span> <span class="p">=</span> <span class="n">generate_distributed_problem_for_aladin</span><span class="p">(</span><span class="n">mpc_split</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="s">&#39;least-squares&#39;</span><span class="p">);</span>
<span class="c">% add a solver</span>
<span class="n">problem</span><span class="p">.</span><span class="n">solver</span> <span class="p">=</span> <span class="s">&#39;fmincon&#39;</span><span class="p">;</span>
<span class="c">% validate problem formulation</span>
<span class="p">[</span><span class="n">xval</span><span class="p">,</span> <span class="n">xval_stacked</span><span class="p">]</span> <span class="p">=</span> <span class="n">validate_distributed_problem_formulation</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">mpc_split</span><span class="p">,</span> <span class="n">names</span><span class="p">);</span>

<span class="n">opts</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;maxiter&#39;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span> <span class="s">&#39;solveQP&#39;</span><span class="p">,</span><span class="s">&#39;MA57&#39;</span><span class="p">);</span>
<span class="n">opts</span><span class="p">.</span><span class="n">reg</span> <span class="p">=</span><span class="s">&#39;false&#39;</span><span class="p">;</span>
<span class="n">opts</span><span class="p">.</span><span class="n">rho0</span><span class="p">=</span> <span class="mf">1e2</span><span class="p">;</span>

<span class="p">[</span><span class="n">xsol_aladin</span><span class="p">,</span> <span class="n">xsol_stack_aladin</span><span class="p">,</span> <span class="n">mpc_sol_aladin</span><span class="p">,</span> <span class="n">logg</span><span class="p">]</span> <span class="p">=</span> <span class="n">solve_distributed_problem_with_aladin</span><span class="p">(</span><span class="n">mpc_split</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>

<span class="n">comparison_aladin</span> <span class="p">=</span> <span class="n">compare_results</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span> <span class="n">xsol_aladin</span><span class="p">)</span>
<span class="n">compare_constraints_violation</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">logg</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
